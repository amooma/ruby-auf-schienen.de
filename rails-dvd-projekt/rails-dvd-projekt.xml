<?xml version="1.0" encoding="UTF-8"?>
<chapter version="5.0" xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title>Rails - Ein erstes Projekt</title>

  <para>Nachdem Sie sich im letzten Kapitel mühsam in die Ruby-Grundlagen
  eingelesen haben, können wir jetzt spannender weitermachen. In diesem
  Kapitel starten wir ein erstes Rails-Projekt und arbeiten uns damit Stück
  für Stück in die Materie ein.</para>

  <para>Auch in diesem Kapitel wird es manchmal hoppla-hopp gehen. Wir stossen
  auf typische Henne-Ei-Probleme wir zum Beispiel: "Wie erkläre ich MVC
  (Model-View-Controller)?". Ich habe mich für den "Wir fangen mal an und
  erklären später."-Ansatz entschieden.</para>

  <section>
    <title>Projektbeschreibung</title>

    <para>Um endlich mal Ordnung in unsere DVD-Sammlung (ich höre schon die
    Stimmen "Wie, die benutzen immer noch DVDs und keine Blue-Rays?") zu
    bringen erstellen wir eine Datenbank die über ein Webinterface bedienbar
    ist.</para>

    <section>
      <title>Erst mal keine Authentifizierung</title>

      <para>Bei diesem ersten Projekt verzichten wir bewusst auf eine
      Authentifizierung des Users. Dies folgt in späteren Kapiteln. Es geht
      jetzt erst mal um das Grundverständnis für Rails.</para>
    </section>
  </section>

  <section>
    <title>Ein neues Rails-Projekt erstellen</title>

    <para>Als aller erstes müssen wir mal ein neues Rails-Projekt erstellen.
    Das geht aber ratz-fatz:<screen>sw@debian:~$ <command>rails dvd-sammlung</command>
      create  
      create  app/controllers
      create  app/helpers
      create  app/models
      create  app/views/layouts
      create  config/environments
      create  config/initializers
      create  config/locales
      create  db
      create  doc
      create  lib
      create  lib/tasks
      create  log
      create  public/images
      create  public/javascripts
      create  public/stylesheets
      create  script/performance
      create  test/fixtures
      create  test/functional
      create  test/integration
      create  test/performance
      create  test/unit
      create  vendor
      create  vendor/plugins
      create  tmp/sessions
      create  tmp/sockets
      create  tmp/cache
      create  tmp/pids
      create  Rakefile
      create  README
      create  app/controllers/application_controller.rb
      create  app/helpers/application_helper.rb
      create  config/database.yml
      create  config/routes.rb
      create  config/locales/en.yml
      create  db/seeds.rb
      create  config/initializers/backtrace_silencers.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/new_rails_defaults.rb
      create  config/initializers/session_store.rb
      create  config/environment.rb
      create  config/boot.rb
      create  config/environments/production.rb
      create  config/environments/development.rb
      create  config/environments/test.rb
      create  script/about
      create  script/console
      create  script/dbconsole
      create  script/destroy
      create  script/generate
      create  script/runner
      create  script/server
      create  script/plugin
      create  script/performance/benchmarker
      create  script/performance/profiler
      create  test/test_helper.rb
      create  test/performance/browsing_test.rb
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/index.html
      create  public/favicon.ico
      create  public/robots.txt
      create  public/images/rails.png
      create  public/javascripts/prototype.js
      create  public/javascripts/effects.js
      create  public/javascripts/dragdrop.js
      create  public/javascripts/controls.js
      create  public/javascripts/application.js
      create  doc/README_FOR_APP
      create  log/server.log
      create  log/production.log
      create  log/development.log
      create  log/test.log
sw@debian:~$ </screen></para>

    <para>Als erstes (so sollte man sich das direkt angewöhnen) prüfen wir
    mal, ob die Installation funktioniert. Dazu starten wir den mitgelieferten
    Server:<screen>sw@debian:~/dvd-sammlung$ <command>./script/server</command> 
=&gt; Booting WEBrick
=&gt; Rails 2.3.5 application starting on http://0.0.0.0:3000
=&gt; Call with -d to detach
=&gt; Ctrl-C to shutdown server
[2009-12-24 23:05:22] INFO  WEBrick 1.3.1
[2009-12-24 23:05:22] INFO  ruby 1.9.1 (2009-12-07) [i686-linux]
[2009-12-24 23:05:22] INFO  WEBrick::HTTPServer#start: pid=18474 port=3000
</screen></para>

    <para>Mit dieser Konfiguration können Sie einen Webbrowser auf dem
    entsprechenden System mit der URL http://0.0.0.0:3000 oder einfacher mit
    http://localhost:3000 starten und sehen dann folgenden Output:<screen>sw@debian:~$ <command>w3m -dump http://localhost:3000</command>
  • [site:rubyonrails.org] [Search] the Rails site
  • Join the community

      □ Ruby on Rails
      □ Official weblog
      □ Wiki
  • Browse the documentation

      □ Rails API
      □ Ruby standard library
      □ Ruby core
      □ Rails Guides

Welcome aboard

You’re riding Ruby on Rails!

About your application’s environment

Getting started

Here’s how to get rolling:

 1. Use script/generate to create your models and controllers

    To see all available options, run it without parameters.

 2. Set up a default route and remove or rename this file

    Routes are set up in config/routes.rb.

 3. Create your database

    Run rake db:migrate to create your database. If you're not using SQLite
    (the default), edit config/database.yml with your username and password.

 
sw@debian:~</screen></para>

    <para>Den Webserver können Sie jederzeit mit <command>CTRL-C</command>
    wieder beenden:<screen>^C[2009-12-24 23:10:00] INFO  going to shutdown ...
[2009-12-24 23:10:00] INFO  WEBrick::HTTPServer#start done.
Exiting
sw@debian:~/dvd-sammlung$</screen></para>

    <section>
      <title>Andere IP-Adresse oder Port gewünscht?</title>

      <para>Per default antwortet der eingebaute Rails-Webserver auf die
      IP-Adresse 0.0.0.0 und den Port 3000. Damit lässt sich super auf einem
      lokalen System entwickeln. Wenn Sie aber Ihren Webbrowser auf einem
      anderen System laufen lassen, als Ihre Rails-Installation, können Sie
      natürlich nicht auf dessen 0.0.0.0 IP-Adresse zugreifen. Sie können aber
      problemlos beide Angaben ändern wie die eingebaute Hilfeseite
      anzeigt:<screen>sw@debian:~/dvd-sammlung$ <command>./script/server -h</command>
Usage: server [options]
    -p, --port=port                  Runs Rails on the specified port.
                                     Default: 3000
    -b, --binding=ip                 Binds Rails to the specified ip.
                                     Default: 0.0.0.0
    -c, --config=file                Use custom rackup configuration file
    -d, --daemon                     Make server run as a Daemon.
    -u, --debugger                   Enable ruby-debugging for the server.
    -e, --environment=name           Specifies the environment to run this server under (test/development/production).
                                     Default: development
    -P, --path=/path                 Runs Rails app mounted at a specific path.
                                     Default: /

    -h, --help                       Show this help message.
sw@debian:~/dvd-sammlung$</screen></para>

      <para>Sollten Sie zum Beispiel (wie ich es oft mache) Ihren Rails-Server
      innerhalb einer VMware laufen lassen, aber von Ihrem Host-Betriebssystem
      den Browser benutzen wollen, so können Sie den Server wie folgt
      starten:<screen>sw@debian:~/dvd-sammlung$ <command>./script/server -b 192.168.248.134</command>
=&gt; Booting WEBrick
=&gt; Rails 2.3.5 application starting on http://192.168.248.134:3000
=&gt; Call with -d to detach
=&gt; Ctrl-C to shutdown server
[2009-12-24 23:19:28] INFO  WEBrick 1.3.1
[2009-12-24 23:19:28] INFO  ruby 1.9.1 (2009-12-07) [i686-linux]
[2009-12-24 23:19:28] INFO  WEBrick::HTTPServer#start: pid=18506 port=3000
</screen></para>

      <para>Damit wäre Ihr Rails-Entwicklungssystem über die URL
      http://192.168.248.134:3000 ansteuerbar.</para>
    </section>

    <section>
      <title>Es läuft schon ein Webserver</title>

      <para>Einer der Gründe für das initiale Starten des Webservers am Anfang
      des Projektes ist zu überprüfen, ob nicht schon ein Rails-Server auf dem
      gleichen System läuft. In diesem Fall bekommen Sie die folgende
      Fehlermeldung ausgegeben:<programlisting>sw@debian:~/dvd-sammlung$ <command>./script/server</command> 
=&gt; Booting WEBrick
=&gt; Rails 2.3.5 application starting on http://0.0.0.0:3000
=&gt; Call with -d to detach
=&gt; Ctrl-C to shutdown server
[2009-12-25 00:22:20] INFO  WEBrick 1.3.1
[2009-12-25 00:22:20] INFO  ruby 1.9.1 (2009-12-07) [i686-linux]
[2009-12-25 00:22:20] WARN  TCPServer Error: Address already in use - bind(2)
Exiting
/usr/local/lib/ruby/1.9.1/webrick/utils.rb:73:in `initialize': Address already in use - bind(2) (Errno::EADDRINUSE)
 from /usr/local/lib/ruby/1.9.1/webrick/utils.rb:73:in `new'
 from /usr/local/lib/ruby/1.9.1/webrick/utils.rb:73:in `block in create_listeners'
 from /usr/local/lib/ruby/1.9.1/webrick/utils.rb:70:in `each'
 from /usr/local/lib/ruby/1.9.1/webrick/utils.rb:70:in `create_listeners'
 from /usr/local/lib/ruby/1.9.1/webrick/server.rb:74:in `listen'
 from /usr/local/lib/ruby/1.9.1/webrick/server.rb:62:in `initialize'
 from /usr/local/lib/ruby/1.9.1/webrick/httpserver.rb:24:in `initialize'
 from /usr/local/lib/ruby/gems/1.9.1/gems/rack-1.0.1/lib/rack/handler/webrick.rb:10:in `new'
 from /usr/local/lib/ruby/gems/1.9.1/gems/rack-1.0.1/lib/rack/handler/webrick.rb:10:in `run'
 from /usr/local/lib/ruby/gems/1.9.1/gems/rails-2.3.5/lib/commands/server.rb:111:in `&lt;top (required)&gt;'
 from ./script/server:3:in `require'
 from ./script/server:3:in `&lt;main&gt;'
sw@debian:~/dvd-sammlung$ </programlisting></para>

      <para>Suchen Sie in so einem Fall bitte nach dem schon laufenden
      Rails-System und beenden Sie es mit <command>CTRL-C</command>.
      Alternativ können Sie natürlich Ihr neues System auf einem anderen Port
      starten. Aber das erhöht nicht gerade die Übersichtlichkeit beim
      Entwickeln. ;-)</para>
    </section>
  </section>

  <section>
    <title>Development Umgebung</title>

    <para>Rails kennt drei verschiedene Arbeits-Umgebungen:<itemizedlist>
        <listitem>
          <para>Development</para>
        </listitem>

        <listitem>
          <para>Testing</para>
        </listitem>

        <listitem>
          <para>Production</para>
        </listitem>
      </itemizedlist></para>

    <para>Wir arbeiten in diesem Kapitel nur mit der Development Umgebung. So
    bald Sie ein besseres Gefühl für Rails bekommen haben, starten wir mit
    Tests und benötigen dafür die entsprechende Umgebung (dort wird z.B. beim
    Start eines Tests die Test-Datenbank neu gefühlt und beim Beenden wird
    gelöscht). Ganz zum Schluss erkläre ich Ihnen dann die verschiedenen
    Szenarien, wie Sie Ihre Rails-Applikation aus der Development-Umgebung in
    die Production-Umgebung ausrollen können.</para>

    <para>Die Development-Umgebung bringt möglichst viel mit. So müssen Sie
    nicht extra einen Webserver installieren, sondern können den eingebauten
    Rails-Webserver benutzen. Der besticht nicht durch extreme Performance,
    aber das benötien wir bei der Entwicklung ja auch nicht. Später kann man
    dann auf grosse Systeme wie <application>Apache</application> umsteigen.
    Das gleiche gilt für die Datenbank.</para>
  </section>

  <section>
    <title>Scaffolding</title>

    <para>Die typischen "Ich zeige Euch mal Ruby on Rails in 15 Minuten"
    Videos arbeiten alle mit der Magie des Scaffolding. Leider ist das
    meistens kontraproduktiv, weil man zwar sehr schnell ein Grundgerüst
    stehen hat, aber danach erst mal im Regen steht (das alte "ohne
    Ruby-Grundkenntnisse kommt man nicht weiter"-Problem schlägt dann
    zu).</para>

    <section>
      <title>Datenbankmodell</title>

      <para>Auch wenn wir jederzeit neue Felder in der Datenbank hinzufügen
      können, so sollte man sich am Anfang möglichst weitreichende Gedanken
      über ein gutes Datenbankmodell machen. Das erspart später dadurch
      notwendige Umstrukturierungen.</para>

      <para>Wir wollen DVDs katalogisieren. Dazu benötigen wir mindestens
      folgende Datenbankfelder:<itemizedlist>
          <listitem>
            <para><varname>title</varname> - Titel oder Name der DVD</para>
          </listitem>

          <listitem>
            <para><varname>production_year</varname> - Produktionsjahr</para>
          </listitem>

          <listitem>
            <para><varname>duration</varname> - Abspieldauer</para>
          </listitem>

          <listitem>
            <para><varname>plot</varname> - Story des Films</para>
          </listitem>

          <listitem>
            <para><varname>rating</varname> - Bewertung (ein 5 Sterne
            System)</para>
          </listitem>
        </itemizedlist></para>

      <section>
        <title>Warum alles auf Englisch?</title>

        <para>Ganz tief im Herzen liebt Rails die englische Sprache. Damit
        muss man sich abfinden und versuchen diese Liebe zu übernehmen. So
        verwenden sehr viele Mechanismen automagisch Plural oder Singular von
        Englischen Wörtern. Wenn man sich damit anfreundet Datenbankfelder und
        Datenbanken an sich mit englischen Wörter zu benennen, dann kann man
        die ganze Macht dieser Magie ausnutzen. </para>
      </section>

      <section>
        <title>Ist das jetzt ein Model (laut der MVC-Idee)?</title>

        <para>Kurze Antwort: Ja. Wir müssen dem Model nur noch einen Namen
        geben. Wie wäre es mit "dvd"?!</para>
      </section>
    </section>

    <section>
      <title>Scaffolding benutzen</title>

      <para>Für unsere (noch?) recht einfache DVD-Datenbank ist Scaffolding
      gut geeignet. Es gibt uns auf die Schnelle ein gutes Grundgerüst, auf
      das wir dann aufbauen können.</para>

      <section>
        <title>./script/generate</title>

        <para>Mit dem Rails-Skript <filename>./script/generate</filename> kann
        man "Sachen" generieren (deshalb wohl der Name). Wer (wie ich) gerne
        mal vergisst wie das Skript aufgerufen werden muss, der gibt einfach
        <filename>./script/generate</filename> ein und bekommt die folgende
        Hilfe angezeigt:<screen>sw@debian:~/dvd-sammlung$ <command>./script/generate</command> 
Usage: ./script/generate generator [options] [args]

Rails Info:
    -v, --version                    Show the Rails version number and quit.
    -h, --help                       Show this help message and quit.

General Options:
    -p, --pretend                    Run but do not make any changes.
    -f, --force                      Overwrite files that already exist.
    -s, --skip                       Skip files that already exist.
    -q, --quiet                      Suppress normal output.
    -t, --backtrace                  Debugging: show backtrace on errors.
    -c, --svn                        Modify files with subversion. (Note: svn must be in path)
    -g, --git                        Modify files with git. (Note: git must be in path)


Installed Generators
  Builtin: controller, helper, integration_test, mailer, metal, migration, model, observer, performance_test, plugin, resource, scaffold, session_migration

More are available at http://wiki.rubyonrails.org/rails/pages/AvailableGenerators
  1. Download, for example, login_generator.zip
  2. Unzip to directory /home/sw/.rails/generators/login
     to use the generator with all your Rails apps
     or to /home/sw/dvd-sammlung/lib/generators/login
     to use with this app only.
  3. Run generate with no arguments for usage information
       ./script/generate login

Generator gems are also available:
  1. gem search -r generator
  2. gem install login_generator
  3. ./script/generate login

sw@debian:~/dvd-sammlung$</screen></para>

        <para>Interessant ist für uns der Teil in dem die "Installed
        Generators" aufgelistet werden. Das sind die "Sachen" die dieses
        Skript generieren kann. Wenn wir scaffold benutzen wollen und dazu
        weitere Hilfe brauchen, dann geht dies wiederrum einfach mit der
        eingebauten Hilfe:<screen>sw@debian:~/dvd-sammlung$ <command>./script/generate scaffold</command>
Usage: ./script/generate scaffold ModelName [field:type, field:type]

Options:
        --skip-timestamps            Don't add timestamps to the migration file for this model
        --skip-migration             Don't generate a migration file for this model
        --force-plural               Forces the generation of a plural ModelName

Rails Info:
    -v, --version                    Show the Rails version number and quit.
    -h, --help                       Show this help message and quit.

General Options:
    -p, --pretend                    Run but do not make any changes.
    -f, --force                      Overwrite files that already exist.
    -s, --skip                       Skip files that already exist.
    -q, --quiet                      Suppress normal output.
    -t, --backtrace                  Debugging: show backtrace on errors.
    -c, --svn                        Modify files with subversion. (Note: svn must be in path)
    -g, --git                        Modify files with git. (Note: git must be in path)

Description:
    Scaffolds an entire resource, from model and migration to controller and
    views, along with a full test suite. The resource is ready to use as a
    starting point for your RESTful, resource-oriented application.

    Pass the name of the model (in singular form), either CamelCased or
    under_scored, as the first argument, and an optional list of attribute
    pairs.

    Attribute pairs are column_name:sql_type arguments specifying the
    model's attributes. Timestamps are added by default, so you don't have to
    specify them by hand as 'created_at:datetime updated_at:datetime'.

    You don't have to think up every attribute up front, but it helps to
    sketch out a few so you can start working with the resource immediately.

    For example, 'scaffold post title:string body:text published:boolean'
    gives you a model with those three attributes, a controller that handles
    the create/show/update/destroy, forms to create and edit your posts, and
    an index that lists them all, as well as a map.resources :posts
    declaration in config/routes.rb.

    If you want to remove all the generated files, run
    'script/destroy scaffold ModelName'.

Examples:
    `./script/generate scaffold post`
    `./script/generate scaffold post title:string body:text published:boolean`
    `./script/generate scaffold purchase order_id:integer amount:decimal`
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Wir müssen also nach <application>./script/generate
        scaffold</application> den Namen des Models (bei uns "dvd") und danach
        die Datenbankfelder mit den entsprechenden Feldtypen angeben.</para>
      </section>

      <section>
        <title>Und los gehts</title>

        <para>Dann legen wir mal los:<screen>sw@debian:~/dvd-sammlung$ <command>./script/generate scaffold dvd title:string production_year:integer duration:integer plot:text rating:integer</command>
      exists  app/models/
      exists  app/controllers/
      exists  app/helpers/
      create  app/views/dvds
      exists  app/views/layouts/
      exists  test/functional/
      exists  test/unit/
      create  test/unit/helpers/
      exists  public/stylesheets/
      create  app/views/dvds/index.html.erb
      create  app/views/dvds/show.html.erb
      create  app/views/dvds/new.html.erb
      create  app/views/dvds/edit.html.erb
      create  app/views/layouts/dvds.html.erb
      create  public/stylesheets/scaffold.css
      create  app/controllers/dvds_controller.rb
      create  test/functional/dvds_controller_test.rb
      create  app/helpers/dvds_helper.rb
      create  test/unit/helpers/dvds_helper_test.rb
       route  map.resources :dvds
  dependency  model
      exists    app/models/
      exists    test/unit/
      exists    test/fixtures/
      create    app/models/dvd.rb
      create    test/unit/dvd_test.rb
      create    test/fixtures/dvds.yml
      create    db/migrate
      create    db/migrate/20091224213402_create_dvds.rb
sw@debian:~/dvd-sammlung$</screen>Und schon ist alles fertig. Alledings ist in
        der Datenbank noch keine entsprechende Tabelle angelegt.</para>
      </section>
    </section>

    <section>
      <title>rake db:migrate</title>

      <para>./script/generate scaffold hat uns schon alles eingerichtet.
      Allerdings müssen wir noch in der Datenbank die Tabelle für unsere Daten
      anlegen. Rails nimmt uns aber die Arbeit ab. Im Verzeichnis db/migrate
      liegen Migrationsdateien, die mit einem Timestamp im Namen versehen
      sind. Im Laufe eines Projektes werden es immer mehr. Sie könne mit dem
      Tool <application>rake</application> in die Datenbank eingespielt
      werden. Aber schauen wir uns erst mal den Inhalt der Migrationsdatei zum
      Modell dvd an:<screen>sw@debian:~/dvd-sammlung$ <command>cat -n db/migrate/20091224213402_create_dvds.rb</command>
     1 class CreateDvds &lt; ActiveRecord::Migration
     2   def self.up
     3     create_table :dvds do |t|
     4       t.string :title
     5       t.integer :production_year
     6       t.integer :duration
     7       t.text :plot
     8       t.integer :rating
     9 
    10       t.timestamps
    11     end
    12   end
    13 
    14   def self.down
    15     drop_table :dvds
    16   end
    17 end
sw@debian:~/dvd-sammlung$</screen></para>

      <para>Die in dieser Ruby-Datei angelegte Class
      <classname>CreateDvds</classname> ist ein Kind der Klasse
      <classname>ActiveRecord::Migration</classname> (siehe Zeile 1) und hat
      zwei Methoden:<itemizedlist>
          <listitem>
            <para><methodname>self.up</methodname> (Zeile 2). Wird aufgerufen,
            wenn die Migration durchgeführt wird.</para>
          </listitem>

          <listitem>
            <para><methodname>self.down</methodname> (Zeile 14). Wird
            aufgerufen, wenn für eine Migration ein Rollback durchgeführt
            wird.</para>
          </listitem>
        </itemizedlist></para>

      <para>Führen wir mal eine Migration durch:<screen>sw@debian:~/dvd-sammlung$ <command>rake db:migrate</command>
(in /home/sw/dvd-sammlung)
==  CreateDvds: migrating =====================================================
-- create_table(:dvds)
   -&gt; 0.0012s
==  CreateDvds: migrated (0.0024s) ============================================

sw@debian:~/dvd-sammlung$</screen></para>

      <para>Die Tabelle <varname>dvds</varname> wird angelegt. Dabei sehen
      wir, das Tabellen-Namen automatisch den Plural der Models bekommen. Aber
      welche Datenbank wird überhaupt benutzt? Das wird in der
      Konfigurationsdatei <filename>config/database.yml</filename>
      definiert:<screen>sw@debian:~/dvd-sammlung$ <command>cat -n config/database.yml</command> 
     1 # SQLite version 3.x
     2 #   gem install sqlite3-ruby (not necessary on OS X Leopard)
     3 development:
     4   adapter: sqlite3
     5   database: db/development.sqlite3
     6   pool: 5
     7   timeout: 5000
     8 
     9 # Warning: The database defined as "test" will be erased and
    10 # re-generated from your development database when you run "rake".
    11 # Do not set this db to the same as development or production.
    12 test:
    13   adapter: sqlite3
    14   database: db/test.sqlite3
    15   pool: 5
    16   timeout: 5000
    17 
    18 production:
    19   adapter: sqlite3
    20   database: db/production.sqlite3
    21   pool: 5
    22   timeout: 5000
sw@debian:~/dvd-sammlung$</screen></para>

      <para>Dort werden drei verschiedene Datenbanken im YAML-Format (siehe
      http://www.yaml.org/ bzw. http://de.wikipedia.org/wiki/YAML) definiert.
      Für uns wichtig ist erst mal nur die development-Datenbank (Zeile 3 bis
      7). Per default benutzt Rails dort <application>sqlite3</application>.
      sqlite3 mag nicht die richtige Wahl für die Analyse der weltweit
      gesammelten Wetterdaten sein, aber für die schnelle und unkompliziete
      Entwicklung von Rails-Anwendungen lernt man sie schnell zu schätzen. In
      der Produktions-Umgebung kann man später immer noch auf "grosse"
      Datenbanken wie MySQL umsteigen.<footnote>
          <para>Es gibt unter einigen Entwicklern die Ansicht, das man auf
          jeden Fall immer mit der gleichen Datenbank entwicklen soll, die man
          später auch in der Produktion und im Testing benutzt. Ich verstehe
          die Argumentation, bin aber anderer Ansicht. Wir werden das Thema
          später bei der Definition von eigenen SQL-Abfragen noch mal
          besprechen.</para>
        </footnote></para>

      <para>Um Ihre Neugierde zu befriedigen, schauen wir uns kurz noch die
      Datenbank mit dem Command-Line-Tool <application>sqlite3</application>
      an.<screen>sw@debian:~/dvd-sammlung$ <command>sqlite3 db/development.sqlite3</command> 
SQLite version 3.5.9
Enter ".help" for instructions
sqlite&gt; <command>.tables</command> 
dvds               schema_migrations
sqlite&gt; <command>.schema dvds</command>
CREATE TABLE "dvds" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "title" varchar(255), "production_year" integer, "duration" integer, "plot" text, "rating" integer, "created_at" datetime, "updated_at" datetime);
sqlite&gt; .quit
sw@debian:~/dvd-sammlung$</screen></para>

      <section>
        <title>Rollback</title>

        <para>Es soll schon vorgekommen sein, das übereilt eine Migration
        durchgeführt wurde. Natürlich passiert weder Ihnen noch mir so was.
        Aber falls mal ein Freund von Ihnen in diese Predulie gerät: Keine
        Panik! Dafür benutzen wir ja Rails und Rails hat sich dazu schon etwas
        ausgedacht. Dafür wurde in der Migrations-Class die Methode
        <methodname>self.down</methodname> angelegt. Testweise können wir ja
        mal unsere letzte Migration zurückrollen:<screen>sw@debian:~/dvd-sammlung$ <command>rake db:rollback</command>
(in /home/sw/dvd-sammlung)
==  CreateDvds: reverting =====================================================
-- drop_table(:dvds)
   -&gt; 0.0005s
==  CreateDvds: reverted (0.0016s) ============================================

sw@debian:~/dvd-sammlung$</screen></para>

        <para>Sie können alles auf einmal zurück-rollen oder auch nur einzelne
        Migrationen. Mit dem Schalter <parameter>-T</parameter> bekommen Sie
        eine Hilfe zu allen möglichen Wegen aufgezeigt:<screen>sw@debian:~/dvd-sammlung$ <command>rake -T db</command>
(in /home/sw/dvd-sammlung)
rake db:abort_if_pending_migrations  # Raises an error if there are pending m...
rake db:charset                      # Retrieves the charset for the current ...
rake db:collation                    # Retrieves the collation for the curren...
rake db:create                       # Create the database defined in config/...
rake db:create:all                   # Create all the local databases defined...
rake db:drop                         # Drops the database for the current RAI...
rake db:drop:all                     # Drops all the local databases defined ...
rake db:fixtures:identify            # Search for a fixture given a LABEL or ID.
rake db:fixtures:load                # Load fixtures into the current environ...
rake db:migrate                      # Migrate the database through scripts i...
rake db:migrate:down                 # Runs the "down" for a given migration ...
rake db:migrate:redo                 # Rollbacks the database one migration a...
rake db:migrate:reset                # Resets your database using your migrat...
rake db:migrate:up                   # Runs the "up" for a given migration VE...
rake db:reset                        # Drops and recreates the database from ...
rake db:rollback                     # Rolls the schema back to the previous ...
rake db:schema:dump                  # Create a db/schema.rb file that can be...
rake db:schema:load                  # Load a schema.rb file into the database
rake db:seed                         # Load the seed data from db/seeds.rb
rake db:sessions:clear               # Clear the sessions table
rake db:sessions:create              # Creates a sessions migration for use w...
rake db:setup                        # Create the database, load the schema, ...
rake db:structure:dump               # Dump the database structure to a SQL file
rake db:test:clone                   # Recreate the test database from the cu...
rake db:test:clone_structure         # Recreate the test databases from the d...
rake db:test:load                    # Recreate the test database from the cu...
rake db:test:prepare                 # Check for pending migrations and load ...
rake db:test:purge                   # Empty the test database
rake db:version                      # Retrieves the current schema version n...
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Aber spielen wir lieber unsere Migration wieder ein:<screen>sw@debian:~/dvd-sammlung$ <command>rake db:migrate</command>
(in /home/sw/dvd-sammlung)
==  CreateDvds: migrating =====================================================
-- create_table(:dvds)
   -&gt; 0.0011s
==  CreateDvds: migrated (0.0021s) ============================================

sw@debian:~/dvd-sammlung$</screen></para>
      </section>
    </section>
  </section>

  <section>
    <title>Start des Systems</title>

    <para>Bitte starten Sie Ihren Webserver:<screen>sw@debian:~/dvd-sammlung$ <command>./script/server</command> 
=&gt; Booting WEBrick
=&gt; Rails 2.3.5 application starting on http://0.0.0.0:3000
=&gt; Call with -d to detach
=&gt; Ctrl-C to shutdown server
[2009-12-25 00:26:24] INFO  WEBrick 1.3.1
[2009-12-25 00:26:24] INFO  ruby 1.9.1 (2009-12-07) [i686-linux]
[2009-12-25 00:26:24] INFO  WEBrick::HTTPServer#start: pid=18632 port=3000
</screen></para>

    <para>Mit Scaffolding haben Sie direkt ein kleine Web-GUI zum
    Administrieren Ihrer DVD-Sammlung bekommen. Diese ist noch sehr
    rudimentär, aber ist ein guter Start.</para>
  </section>

  <section>
    <title>Zugriff per HTTP-Protokoll</title>

    <para>Gemäss der CRUD Idee (siehe http://de.wikipedia.org/wiki/CRUD)
    bietet Rails ein RESTful Webinterface an. Was heisst das? Sie können auf
    jede Resource innerhalb einer normalen Rails-Umgeben über definierte URLs
    zugreifen und damit folgende Datenbank-Operationen ausführen:<itemizedlist>
        <listitem>
          <para>C für CREATE</para>

          <para>SQL: <code>INSERT INTO dvds (title) VALUES ('Rain
          Man')</code></para>
        </listitem>

        <listitem>
          <para>R für READ</para>

          <para>SQL: <code>SELECT * FROM dvds</code></para>
        </listitem>

        <listitem>
          <para>U für UPDATE</para>

          <para>SQL: <code>UPDATE dvds SET title = 'Rain Man' WHERE id =
          1</code></para>
        </listitem>

        <listitem>
          <para>D für DELETE</para>

          <para>SQL: <code>DELETE FROM dvds WHERE id = 1</code></para>
        </listitem>
      </itemizedlist>Um die CRUD Idee besser erklären zu können, habe ich in
    den nachfolgenden Beispielen drei Beispiel-Filme aus der Terminator-Reihe
    in die Datenbank gefüttert.<qandaset>
        <qandadiv>
          <qandaentry>
            <question>
              <para>Warum wird um das RESTful Interface in Ruby on Rails so
              ein Bohei gemacht?</para>
            </question>

            <answer>
              <para>Damit bekommt man ein sauberes und für alle Programmierer
              leicht verständliches Interface zu Ihrem System. Sie brauchen
              nur die URI <uri>http://localhost:3000/dvds</uri> und das
              Wissen, das es sich um ein RESTful Webdienst handelt und Sie
              können direkt loslegen.</para>
            </answer>
          </qandaentry>

          <qandaentry>
            <question>
              <para>Ist RESTful nur für die automatische Abfrage zwischen
              Computern gut?</para>
            </question>

            <answer>
              <para>Nein. RESTful ist auch ein guter Denkansatz, um URLs und
              damit ganze Webseiten strukturierter zu gestalten.</para>
            </answer>
          </qandaentry>
        </qandadiv>
      </qandaset></para>

    <section>
      <title>HTML-Webbrowser</title>

      <para>Sie können mit einem normalen Webbrowser alle CRUD Aktionen
      ausführen und bekommen ein von Menschen leicht bedienbares
      HTML-Interface.</para>

      <section>
        <title>index</title>

        <para>Die Liste aller aktuell gespeicherten DVDs bekommen Sie unter
        der URL <uri>http://localhost:3000/dvds</uri><screen>sw@debian:~/dvd-sammlung$ <command>w3m -dump http://localhost:3000/dvds</command>
Received cookie: _dvd-sammlung_session=BAh7BzoPc2Vzc2lvbl9pZCIlMjljNWZmNDdlNGVmMGU3OGMwODk4NWM0NmY2ZGZhYzQ6EF9jc3JmX3Rva2VuSSIxQ0VMamhTWHRodGc4c2o0ZndQVUtDUmYwbHZJWGp0SWRaV2JQMUFFdGFRYz0GOg1lbmNvZGluZyINVVMtQVNDSUk%3D--010ffc05a95aa7059e7266e4ced21836bb06cd3a
Listing dvds

       Title         Production year Duration Plot Rating
The Terminator       1984                                 Show Edit Destroy
Terminator 2         1992                                 Show Edit Destroy
Terminator Salvation 2009                                 Show Edit Destroy


New dvd
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#index (for 127.0.0.1 at 2009-12-25 01:56:29) [GET]
  Dvd Load (0.8ms)   SELECT * FROM "dvds" 
Rendering template within layouts/dvds
Rendering dvds/index
Completed in 44ms (View: 41, DB: 1) | 200 OK [http://localhost/dvds]
</screen></para>
      </section>

      <section>
        <title>new</title>

        <para>Eine neue DVD können Sie unter der URL
        <uri>http://localhost:3000/dvds/new</uri> eintragen:<screen>sw@debian:~/dvd-sammlung$ <command>w3m -dump http://localhost:3000/dvds/new</command>
Received cookie: _dvd-sammlung_session=BAh7BzoPc2Vzc2lvbl9pZCIlZThhNjAxZjE1MThlMzcyZmYzOGIxOTM1Y2JlZTM5MmI6EF9jc3JmX3Rva2VuSSIxdFBoTnFPTEJGbmgrajVQVmNoKzhnNVM1Z3N0aFFOYkdNaEpxNWJlbnpBbz0GOg1lbmNvZGluZyINVVMtQVNDSUk%3D--59c0c0badd6f26c43a0b0b5bcabebbf61c97ca76
New dvd

Title
[                              ]

Production year
[                              ]

Duration
[                              ]

Plot
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]

Rating
[                              ]

[Create]

Back
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#new (for 127.0.0.1 at 2009-12-25 01:57:38) [GET]
Rendering template within layouts/dvds
Rendering dvds/new
Completed in 33ms (View: 10, DB: 0) | 200 OK [http://localhost/dvds/new]
</screen></para>

        <para>Nachdem Sie Beispieldaten eingegeben und auf Create geklickt
        haben, werden Sie folgende Ausgabe im Log sehen:<screen>Processing DvdsController#create (for 127.0.0.1 at 2009-12-25 01:59:31) [POST]
  Parameters: {"authenticity_token"=&gt;"DmNBZo3HfeQOxm2fSSJswuGkJpHHegddgbLNj1aCe/I=", "dvd"=&gt;{"title"=&gt;"Rain Man", "production_year"=&gt;"1988", "duration"=&gt;"", "plot"=&gt;"Geschichte zweier sehr ungleicher Br\xC3\xBCder.\r\n", "rating"=&gt;"5"}, "commit"=&gt;"Create"}
  Dvd Create (0.2ms)   INSERT INTO "dvds" ("title", "production_year", "duration", "plot", "rating", "created_at", "updated_at") VALUES('Rain Man', 1988, NULL, 'Geschichte zweier sehr ungleicher Brüder.
', 5, '2009-12-24 23:38:31', '2009-12-24 23:38:31')
Redirected to http://localhost:3000/dvds/1
Completed in 63ms (DB: 0) | 302 Found [http://localhost/dvds]
</screen></para>

        <para>Danach werden Sie auf die show-Seite dieses Eintrages
        umgeleitet.</para>
      </section>

      <section>
        <title>show</title>

        <para>Eine einzelne DVD kann man sich mit der ID des Eintrages (hier
        die 1) und der entsprechenden URL
        <uri>http://localhost:3000/dvds/show/1</uri> anschauen. Alternativ
        geht auch die Kurzform <uri>http://localhost:3000/dvds/1</uri><screen>sw@debian:~/dvd-sammlung$ <command>w3m -dump http://localhost:3000/dvds/1</command>
Received cookie: _dvd-sammlung_session=BAh7BjoPc2Vzc2lvbl9pZCIlMTQ3YTgyNTU3OTUzZGUyYTc4NmIxYTE4MWNiYTZjYmM%3D--787ebfba94fba9eeb0ad1d9de51d2b3933230e2c
Title: The Terminator

Production year: 1984

Duration:

Plot:

Rating:

Edit | Back
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#show (for 127.0.0.1 at 2009-12-25 01:59:32) [GET]
  Parameters: {"id"=&gt;"1"}
  Dvd Load (0.2ms)   SELECT * FROM "dvds" WHERE ("dvds"."id" = 1) 
Rendering template within layouts/dvds
Rendering dvds/show
Completed in 12ms (View: 8, DB: 0) | 200 OK [http://localhost/dvds/1]
</screen></para>
      </section>

      <section>
        <title>edit</title>

        <para>Den Eintrag dieser einzelnen DVD können Sie mit der URL
        <uri>http://localhost:3000/dvds/edit/1</uri> ändern.<screen>sw@debian:~/dvd-sammlung$ <command>w3m -dump http://localhost:3000/dvds/edit/1</command>
Received cookie: _dvd-sammlung_session=BAh7BzoPc2Vzc2lvbl9pZCIlOWM5YjM3MzRlZGJiZmY2ZWZlZjk4MTAxNTFjMmYyZGE6EF9jc3JmX3Rva2VuSSIxN3BpdmdxcVlIeEhuQmZSVEFPaVRDT1crb2hFeVZxMkMwYWNaYzRuVkV6ST0GOg1lbmNvZGluZyINVVMtQVNDSUk%3D--efd0399080f39207d6f46b731c4be6a179624322
Editing dvd

Title
[The Terminator                ]

Production year
[1984                          ]

Duration
[                              ]

Plot
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]

Rating
[                              ]

[Update]

Show | Back
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#edit (for 127.0.0.1 at 2009-12-25 02:00:39) [GET]
  Parameters: {"id"=&gt;"1"}
  Dvd Load (0.2ms)   SELECT * FROM "dvds" WHERE ("dvds"."id" = 1) 
Rendering template within layouts/dvds
Rendering dvds/edit
Completed in 14ms (View: 11, DB: 0) | 200 OK [http://localhost/dvds/edit/1]
</screen></para>
      </section>

      <section>
        <title>update</title>

        <para>Beispielhaft füllen wir das Webinterface aus dem edit-Beispiel
        wie folgt aus:<screen>Editing dvd

Title
[The Terminator                ]

Production year
[1984                          ]

Duration
[                              ]

Plot
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]
[                                        ]

Rating
[5                             ]

[Update]

Show | Back</screen></para>

        <para>Danach klicken wir auf <command>[Update]</command>. Dabei sehen
        wir im Webserver-Log folgende Ausgabe:<screen>Processing DvdsController#update (for 127.0.0.1 at 2009-12-25 02:03:55) [PUT]
  Parameters: {"authenticity_token"=&gt;"z9rs1PeGoyeEvA1TyOZ000wPsS10OQFVdh2pa0AxA30=", "dvd"=&gt;{"title"=&gt;"The Terminator", "production_year"=&gt;"1984", "duration"=&gt;"", "plot"=&gt;"", "rating"=&gt;"5"}, "commit"=&gt;"Update", "id"=&gt;"1"}
  Dvd Load (0.2ms)   SELECT * FROM "dvds" WHERE ("dvds"."id" = 1) 
  Dvd Update (0.2ms)   UPDATE "dvds" SET "plot" = '', "rating" = 5, "updated_at" = '2009-12-25 01:03:55' WHERE "id" = 1
Redirected to http://localhost:3000/dvds/1
Completed in 406ms (DB: 0) | 302 Found [http://localhost/dvds/1]


Processing DvdsController#show (for 127.0.0.1 at 2009-12-25 02:03:56) [GET]
  Parameters: {"id"=&gt;"1"}
  Dvd Load (0.2ms)   SELECT * FROM "dvds" WHERE ("dvds"."id" = 1) 
Rendering template within layouts/dvds
Rendering dvds/show
Completed in 6ms (View: 3, DB: 0) | 200 OK [http://localhost/dvds/1]
</screen></para>

        <para>Nach dem Update des Eintrages, werden wir automatisch auf die
        show-Seite des Eintrages umgeleitet.</para>
      </section>

      <section>
        <title>destroy</title>

        <para>Sie können den eben angelegten Datensatz mit der URL
        <uri>http://localhost:3000/dvds/destroy/1</uri> wieder aus der
        Datenbank löschen.<screen>sw@debian:~/dvd-sammlung$ <command>w3m -dump http://localhost:3000/dvds/destroy/1</command>
Received cookie: _dvd-sammlung_session=BAh7BzoPc2Vzc2lvbl9pZCIlMDRhZDA2OGViMjhhMTg1YjMxNzk0ODQxNjExMjRhYWE6EF9jc3JmX3Rva2VuSSIxckQrR0hwVWRmak53RDh3ZDRhcjNpMVdZWFFtM1hkQUhEa0F6M3VqMHlVdz0GOg1lbmNvZGluZyINVVMtQVNDSUk%3D--79f2cb0361e0319908cf252987e08b4bf3746f00
Listing dvds

       Title         Production year Duration Plot Rating
Terminator 2         1992                                 Show Edit Destroy
Terminator Salvation 2009                                 Show Edit Destroy


New dvd
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#destroy (for 127.0.0.1 at 2009-12-25 02:05:48) [GET]
  Parameters: {"id"=&gt;"1"}
  Dvd Load (0.2ms)   SELECT * FROM "dvds" WHERE ("dvds"."id" = 1) 
  Dvd Destroy (0.1ms)   DELETE FROM "dvds" WHERE "id" = 1
Redirected to http://localhost:3000/dvds
Completed in 386ms (DB: 0) | 302 Found [http://localhost/dvds/destroy/1]
</screen></para>

        <para>Nach dem destroy wird auf index umgeleitet.</para>
      </section>
    </section>

    <section>
      <title>Per XML</title>

      <para>Das XML-Interface erleichtert den Austausch von Daten zwischen
      Maschinen. Dabei wird der ganze HTML-Balast abgeworfen und nur noch die
      reinen Daten per XML ausgetauscht.<important>
          <para>Damit diese Beispiele problemlos funktionieren, habe ich
          <parameter>protect_from_forgery</parameter> in der
          <filename>app/controllers/application_controller.rb</filename> durch
          auskommentieren deaktiviert. Dadurch entfällt eine per default
          aktivierte Sicherheitsschicht, die einen Token austauscht, um die
          anonyme Interaktion von aussen zu underbinden. In späteren Kapiteln
          besprechen wir Authentifizierungsmechanismen für diese Fälle.</para>
        </important></para>

      <section>
        <title>index</title>

        <para>Die Liste aller aktuell gespeicherten DVDs bekommen Sie unter
        der URL <uri>http://localhost:3000/dvds.xml</uri><screen>sw@debian:~/dvd-sammlung$ <command>curl -X GET http://localhost:3000/dvds.xml</command>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;dvds type="array"&gt;
  &lt;dvd&gt;
    &lt;created-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/created-at&gt;
    &lt;duration type="integer" nil="true"&gt;&lt;/duration&gt;
    &lt;id type="integer"&gt;1&lt;/id&gt;
    &lt;plot nil="true"&gt;&lt;/plot&gt;
    &lt;production-year type="integer"&gt;1984&lt;/production-year&gt;
    &lt;rating type="integer" nil="true"&gt;&lt;/rating&gt;
    &lt;title&gt;The Terminator&lt;/title&gt;
    &lt;updated-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/updated-at&gt;
  &lt;/dvd&gt;
  &lt;dvd&gt;
    &lt;created-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/created-at&gt;
    &lt;duration type="integer" nil="true"&gt;&lt;/duration&gt;
    &lt;id type="integer"&gt;2&lt;/id&gt;
    &lt;plot nil="true"&gt;&lt;/plot&gt;
    &lt;production-year type="integer"&gt;1992&lt;/production-year&gt;
    &lt;rating type="integer" nil="true"&gt;&lt;/rating&gt;
    &lt;title&gt;Terminator 2&lt;/title&gt;
    &lt;updated-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/updated-at&gt;
  &lt;/dvd&gt;
  &lt;dvd&gt;
    &lt;created-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/created-at&gt;
    &lt;duration type="integer" nil="true"&gt;&lt;/duration&gt;
    &lt;id type="integer"&gt;3&lt;/id&gt;
    &lt;plot nil="true"&gt;&lt;/plot&gt;
    &lt;production-year type="integer"&gt;2009&lt;/production-year&gt;
    &lt;rating type="integer" nil="true"&gt;&lt;/rating&gt;
    &lt;title&gt;Terminator Salvation&lt;/title&gt;
    &lt;updated-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/updated-at&gt;
  &lt;/dvd&gt;
&lt;/dvds&gt;
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#index to xml (for 127.0.0.1 at 2009-12-25 02:11:09) [GET]
  Dvd Load (0.9ms)   SELECT * FROM "dvds" 
Completed in 494ms (View: 491, DB: 1) | 200 OK [http://0.0.0.0/dvds.xml]
</screen></para>
      </section>

      <section>
        <title>new</title>

        <para>Um eine neue DVD einzutragen, benötigen Sie als erstes die
        Felder die ausgefüllt werden müssen. Dazu können Sie die URL
        <uri>http://localhost:3000/dvds/new.xml</uri> abrufen:<screen>sw@debian:~/dvd-sammlung$ <command>curl -X GET http://0.0.0.0:3000/dvds/new.xml</command>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;dvd&gt;
  &lt;created-at type="datetime" nil="true"&gt;&lt;/created-at&gt;
  &lt;duration type="integer" nil="true"&gt;&lt;/duration&gt;
  &lt;plot nil="true"&gt;&lt;/plot&gt;
  &lt;production-year type="integer" nil="true"&gt;&lt;/production-year&gt;
  &lt;rating type="integer" nil="true"&gt;&lt;/rating&gt;
  &lt;title nil="true"&gt;&lt;/title&gt;
  &lt;updated-at type="datetime" nil="true"&gt;&lt;/updated-at&gt;
&lt;/dvd&gt;
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#new to xml (for 127.0.0.1 at 2009-12-25 02:12:34) [GET]
Completed in 6ms (View: 2, DB: 0) | 200 OK [http://0.0.0.0/dvds/new.xml]
</screen></para>

        <para>Danach können Sie mit einem create Aufruf die Daten für einen
        neuen Datensatz uploaden:<screen>sw@debian:~/dvd-sammlung$ <command>curl -X POST -d "&lt;dvd&gt;&lt;title&gt;Rain Man&lt;/title&gt;&lt;production-year&gt;1988&lt;/production-year&gt;&lt;/dvd&gt;" http://localhost:3000/dvds</command>
&lt;html&gt;&lt;body&gt;You are being &lt;a href="http://localhost:3000/dvds/5"&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Ausgabe im Log:<screen>Processing DvdsController#create (for 127.0.0.1 at 2009-12-25 02:25:33) [POST]
  Parameters: {"&lt;dvd&gt;&lt;title&gt;Rain Man&lt;/title&gt;&lt;production-year&gt;1988&lt;/production-year&gt;&lt;/dvd&gt;"=&gt;nil}
  Dvd Create (0.3ms)   INSERT INTO "dvds" ("title", "production_year", "duration", "plot", "rating", "created_at", "updated_at") VALUES(NULL, NULL, NULL, NULL, NULL, '2009-12-25 01:25:33', '2009-12-25 01:25:33')
Redirected to http://localhost:3000/dvds/5
Completed in 52ms (DB: 0) | 302 Found [http://localhost/dvds]
</screen></para>

        <para>Danach werden Sie auf die show-Seite dieses Eintrages
        umgeleitet.</para>
      </section>

      <section>
        <title>show</title>

        <para>Eine einzelne DVD kann man sich mit der ID des Eintrages (hier
        die 1) und der entsprechenden URL
        <uri>http://localhost:3000/dvds/show/1.xml</uri> anschauen. Alternativ
        geht auch die Kurzform
        <uri>http://localhost:3000/dvds/1.xml</uri><screen>sw@debian:~/dvd-sammlung$ <command>curl -X GET http://localhost:3000/dvds/1.xml</command>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;dvd&gt;
  &lt;created-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/created-at&gt;
  &lt;duration type="integer" nil="true"&gt;&lt;/duration&gt;
  &lt;id type="integer"&gt;1&lt;/id&gt;
  &lt;plot nil="true"&gt;&lt;/plot&gt;
  &lt;production-year type="integer"&gt;1984&lt;/production-year&gt;
  &lt;rating type="integer" nil="true"&gt;&lt;/rating&gt;
  &lt;title&gt;The Terminator&lt;/title&gt;
  &lt;updated-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/updated-at&gt;
&lt;/dvd&gt;
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#show to xml (for 127.0.0.1 at 2009-12-25 02:31:28) [GET]
  Parameters: {"id"=&gt;"1"}
  Dvd Load (0.2ms)   SELECT * FROM "dvds" WHERE ("dvds"."id" = 1) 
Completed in 7ms (View: 3, DB: 0) | 200 OK [http://localhost/dvds/1.xml]
</screen></para>
      </section>

      <section>
        <title>edit - update</title>

        <para>Zum Editieren eines Eintrages downloaden wir diesen Eintrag erst
        wieder von der entsprechenden URL
        <uri>http://localhost:3000/dvds/1.xml</uri><screen>sw@debian:~/dvd-sammlung$ <command>curl -X GET http://localhost:3000/dvds/1.xml</command>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;dvd&gt;
  &lt;created-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/created-at&gt;
  &lt;duration type="integer" nil="true"&gt;&lt;/duration&gt;
  &lt;id type="integer"&gt;1&lt;/id&gt;
  &lt;plot nil="true"&gt;&lt;/plot&gt;
  &lt;production-year type="integer"&gt;1984&lt;/production-year&gt;
  &lt;rating type="integer" nil="true"&gt;&lt;/rating&gt;
  &lt;title&gt;The Terminator&lt;/title&gt;
  &lt;updated-at type="datetime"&gt;2009-12-25T01:10:54Z&lt;/updated-at&gt;
&lt;/dvd&gt;
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Danach posten wir den entsprechenden Eintrag neu (in diesem
        Beispiel setzen wir das Rating auf 5 Sterne). Wichtig dabei ist, das
        wir die <parameter>id</parameter> des Eintrages mit
        übertragen:<screen>sw@debian:~/dvd-sammlung$ <command>curl -X PUT -d "&lt;dvd&gt;&lt;id&gt;1&lt;/id&gt;&lt;rating&gt;5&lt;/rating&gt;&lt;/dvd&gt;" http://localhost:3000/dvds/update/1.xml</command>
sw@debian:~/dvd-sammlung$ </screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#update to xml (for 127.0.0.1 at 2009-12-25 02:46:31) [PUT]
  Parameters: {"&lt;dvd&gt;&lt;id&gt;1&lt;/id&gt;&lt;rating&gt;5&lt;/rating&gt;&lt;/dvd&gt;"=&gt;nil, "id"=&gt;"1"}
  Dvd Load (0.2ms)   SELECT * FROM "dvds" WHERE ("dvds"."id" = 1) 
Completed in 5ms (View: 0, DB: 0) | 200 OK [http://localhost/dvds/update/1.xml]
</screen></para>
      </section>

      <section>
        <title>destroy</title>

        <para>Sie können den eben angelegten Datensatz mit der URL
        <uri>http://localhost:3000/dvds/destroy/1</uri> wieder aus der
        Datenbank löschen.<screen>sw@debian:~/dvd-sammlung$ <command>curl -X DELETE http://localhost:3000/dvds/1.xml</command>
sw@debian:~/dvd-sammlung$</screen></para>

        <para>Im Log des Webservers sehen Sie folgende Ausgabe:<screen>Processing DvdsController#destroy to xml (for 127.0.0.1 at 2009-12-25 02:49:40) [DELETE]
  Parameters: {"id"=&gt;"1"}
  Dvd Load (0.2ms)   SELECT * FROM "dvds" WHERE ("dvds"."id" = 1) 
  Dvd Destroy (0.2ms)   DELETE FROM "dvds" WHERE "id" = 1
Completed in 128ms (View: 0, DB: 0) | 200 OK [http://localhost/dvds/1.xml]
</screen></para>
      </section>
    </section>

    <section>
      <title>./script/console</title>

      <para></para>
    </section>
  </section>
</chapter>
